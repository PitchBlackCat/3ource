<html>
<head>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
</head>
<body>

<form>
Enter your github username and password to bypass the 60 requests per hour limit for unauthenticated API accesses. <br>
username: <input id="username" type="text" value="zodiac"/> <br>
password: <input id="password" type="password" value=""/> <br><br>
owner: <input id="owner" value="zz85" /> <br/>
repo: <input id="repo" value="3ource" /> <br/>
<button onclick="start(); return false;">Load commit data from Github</button>
</form>
<script>


function git_url() {
	username = $("#username").val();
	password = $("#password").val();

	owner = $("#owner").val();
	repo = $("#repo").val();

	login = username + ":" + password;
	return "https://" + login + "@api.github.com/repos/" + owner + "/" + repo + "/git";
}
function getAllRefs() {
	url = git_url() + "/refs" + "?callback=getRefsCallback";
	return $.get(url);
}

function getCommit(sha) {
	url = git_url() + "/commits/" + sha + "?callback=processCommit";
	return $.get(url);
}

commits = [];

function clean(c) {
	return {'message': c.message,
			'author': c.author.name,
			'time': c.author.date,
			'parents': c.parents,
			'files': []}
}

function processCommit(commit) {
	commit = commit.data;
	commits.push(clean(commit));

	for (i in commit.parents) {
		p = commit.parents[i];

		getCommit(p.sha);
	}

	if (commit.parents.length == 0) {
		console.log('loading done');
	}
}

function start() {

	promised_commits = [];
	commits = [];

	getAllRefs();
}

function getRefsCallback(refs) {
	refs = refs.data;
	for (i in refs) {
		commit = refs[i];
		if (commit.object.type === "commit") {
			getCommit(commit.object.sha);
		}
	}
}


</script>

</body>
</html>